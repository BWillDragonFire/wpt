<!DOCTYPE html>
<html class="reftest-wait">
<meta name=fuzzy content="0-1; 9000-10000">
<link rel="help" href="https://drafts.csswg.org/css-backgrounds-3/#background-color">
<link rel="match" href="transition-delayed-ten-frames-ref.html">
<style>
.container {
  width: 100px;
  height: 100px;
  background-color: rgb(0, 200, 0);
  transition-property: background-color;
  transition-duration: 1s;
}
</style>
<script src="/common/reftest-wait.js"></script>
<body>
<div class="container" id="target"></div>

<script>
// This is a regression test for crbug.com/1177320. I found that with enough
// empty frames before setting the backgroundColor, we need to trigger a repaint
// when the transition happens, and this test ensures that the repaint is
// triggered. Two things to note:
// 1. I put 10 frames in front, I don't know how many is minimum, we might
//    have to tweak the number. But 10 frame won't trigger a time out.
//    I can do this with setTimeout to delay "setting backgroundColor" by
//    certain amount of time, but I'd avoid using setTimeout.
// 2. I cannot set the transition duration and delay like the
//    "one-element-transition.html". If I do that, somehow it re-run the
//    animation and got correct result even without my fix. So I set the
//    transition duration to 1s and the start and end color of the transition
//    is very close to each other. In order to prevent flakiness on different
//    bots, I used fuzzy match.
function runRaf(countdown) {
  countdown--;
  if (countdown > 0) {
    requestAnimationFrame(function() {
      runRaf(countdown);
    });
  } else if (countdown == 0) {
    document.getElementById("target").style.backgroundColor = "rgb(0, 199, 0)";
    requestAnimationFrame(() => {
      takeScreenshot();
    });
  }
}
runRaf(10);
</script>
</body>
</html>
